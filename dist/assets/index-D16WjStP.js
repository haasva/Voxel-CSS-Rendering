(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const e of o)if(e.type==="childList")for(const l of e.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function r(o){const e={};return o.integrity&&(e.integrity=o.integrity),o.referrerPolicy&&(e.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?e.credentials="include":o.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function n(o){if(o.ep)return;o.ep=!0;const e=r(o);fetch(o.href,e)}})();const F=Math.sqrt(3),U=.5*(F-1),I=(3-F)/6,W=s=>Math.floor(s)|0,j=new Float64Array([1,1,-1,1,1,-1,-1,-1,1,0,-1,0,1,0,-1,0,0,1,0,-1,0,1,0,-1]);function J(s=Math.random){const t=ee(s),r=new Float64Array(t).map(o=>j[o%12*2]),n=new Float64Array(t).map(o=>j[o%12*2+1]);return function(e,l){let c=0,f=0,u=0;const a=(e+l)*U,d=W(e+a),h=W(l+a),p=(d+h)*I,x=d-p,M=h-p,y=e-x,w=l-M;let k,X;y>w?(k=1,X=0):(k=0,X=1);const Y=y-k+I,$=w-X+I,D=y-1+2*I,A=w-1+2*I,O=d&255,q=h&255;let P=.5-y*y-w*w;if(P>=0){const b=O+t[q],C=r[b],Z=n[b];P*=P,c=P*P*(C*y+Z*w)}let S=.5-Y*Y-$*$;if(S>=0){const b=O+k+t[q+X],C=r[b],Z=n[b];S*=S,f=S*S*(C*Y+Z*$)}let B=.5-D*D-A*A;if(B>=0){const b=O+1+t[q+1],C=r[b],Z=n[b];B*=B,u=B*B*(C*D+Z*A)}return 70*(c+f+u)}}function ee(s){const r=new Uint8Array(512);for(let n=0;n<512/2;n++)r[n]=n;for(let n=0;n<512/2-1;n++){const o=n+~~(s()*(256-n)),e=r[n];r[n]=r[o],r[o]=e}for(let n=256;n<512;n++)r[n]=r[n-256];return r}let m;class te{constructor({sizeX:t=500,sizeY:r=500,sizeZ:n=10,maxElevation:o=1,noiseScale:e=2,seed:l=Math.random()}={}){this.sizeX=t,this.sizeY=r,this.sizeZ=n,this.maxElevation=o,this.noiseScale=e,this.noise2D=J(()=>l),this.worldData=this._generateWorld()}_generateWorld(){const{sizeX:t,sizeY:r,sizeZ:n,maxElevation:o,noiseScale:e,noise2D:l}=this;let c=new Array(t).fill(null).map(()=>new Array(r).fill(null).map(()=>new Array(n).fill(null).map(()=>({isBlock:!1,material:"air",shadedTop:!1})))),f=new Array(t).fill(0).map(()=>new Array(r).fill(0));for(let a=0;a<t;a++)for(let d=0;d<r;d++){let h=l(a/e,d/e);f[a][d]=Math.floor((h+1)/2*o)}for(let a=0;a<t;a++)for(let d=0;d<r;d++){let h=f[a][d];for(let p=0;p<n;p++)p<=h&&(c[a][d][p].isBlock=!0,c[a][d][p].elevation=h,p===h&&(c[a][d][p].material="grass",Math.random()<.1&&(c[a][d][p].material="tree",c[a][d][p].hasTree=!0)))}const u=[[1,0],[-1,0],[0,1],[0,-1],[-1,-1],[-1,1],[1,1],[1,-1]];for(let a=0;a<t;a++)for(let d=0;d<r;d++){let h=f[a][d];if(h<0||h>=n)continue;const p=c[a][d][h];if(p.isBlock)for(let[x,M]of u){const y=a+x,w=d+M;if(!(y<0||w<0||y>=t||w>=r)&&f[y][w]>h){p.shadedTop=!0;break}}}return c}getWorldData(){return this.worldData}}const R=new te({sizeX:500,sizeY:500,sizeZ:20,maxElevation:8,noiseScale:20});console.log(R.getWorldData());function oe(){m=R.getWorldData()}document.getElementById("e-plane");function ne(){const s=document.createElement("div");s.id="ePlane";const t=5;for(let r=0;r<10;r++)for(let n=0;n<10;n++){const o=i.worldX-t+n,e=i.worldY-t+r,l=i.worldZ,c=document.createElement("div");c.className="eCell",c.textContent=`${o},${e},${l}`,o<0||o>=m.length||e<0||e>=m[0].length,s.appendChild(c)}document.getElementById("renderer").appendChild(s)}async function re(){var n;const s=document.getElementById("ePlane");if(!s)return;s.style.transform=`rotateX(90deg)  rotateZ(180deg) translateZ(${-((i.worldZ-2)*100)}px) translateX(-100px)`;let t=0;const r=5;for(let o=0;o<10;o++)for(let e=0;e<10;e++){const l=i.worldX-r+e,c=i.worldY-r+o,f=s.children[t];if(f.innerHTML="",l<0||l>=m.length||c<0||c>=m[0].length)f.textContent="X",f.style.background="#400";else{let u=-1;for(let d=0;d<m[0][0].length;d++)(n=m[l][c][d])!=null&&n.isBlock&&(u=d);const a=u;f.style.transform=`translateZ(${a*100}px)`;for(let d=0;d<m[0][0].length;d++)m[l][c][d].hasTree===!0&&(f.appendChild(se(l,c)),f.classList.add("tree"))}t++}}const H=new Map;function se(s,t){const r=`${s},${t}`,n=document.createElement("div");return n.className="tree",n.classList.add("cardboard"),H.set(n,{cellKey:r,element:n}),n}const E={horizontal:[],verticalX:[],verticalY:[]},i={worldX:250,worldY:250,worldZ:10};let v,z,L;function le(){const s=document.getElementById("renderer"),t=200*10,r=100,n=11;for(let o=0;o<n;o++){const e=document.createElement("canvas");e.width=t,e.height=t,e.classList.add("horizontal"),o===0&&e.classList.add("floor"),e.style.transform=`
      translateY(${500-o*r}px)
       rotateX(-90deg) rotateY(180deg)

    `,s.appendChild(e),E.horizontal.push(e)}for(let o=0;o<n;o++){const e=document.createElement("canvas");e.width=t,e.height=t,e.classList.add("verticalX"),o===0&&e.classList.add("first"),o===10&&e.classList.add("last"),e.style.transform=`
      translateX(${500-o*r}px)
      rotateY(90deg)


    `,s.appendChild(e),E.verticalX.push(e)}for(let o=0;o<n;o++){const e=document.createElement("canvas");e.width=t,e.height=t,e.classList.add("verticalY"),o===0&&e.classList.add("first"),o===10&&e.classList.add("last"),e.style.transform=`
      translateZ(${500-o*r}px)
      rotateX(0deg)
      rotateY(180deg)


    `,s.appendChild(e),E.verticalY.push(e)}Object.values(E).forEach(o=>{o.forEach(e=>{e.style.msInterpolationMode="nearest-neighbor";const l=e.getContext("2d");l.imageSmoothingEnabled=!1,l.mozImageSmoothingEnabled=!1,l.webkitImageSmoothingEnabled=!1,l.msImageSmoothingEnabled=!1})}),ae(()=>{console.log("All textures loaded!"),_()})}function _(){G(E.horizontal,"z"),G(E.verticalX,"x"),G(E.verticalY,"y")}const V={};function ae(s){const t={desert:"art/desert.png",steppe:"art/steppe.png",montane:"art/montane.jpg"};let r=0;const n=Object.keys(t).length;Object.entries(t).forEach(([o,e])=>{const l=new Image;l.src=e,l.onload=()=>{V[o]=l,r++,r===n&&typeof s=="function"&&s()},l.onerror=()=>{r++,r===n&&typeof s=="function"&&s()}}),console.log(V)}const ie={z:[{name:"top",offset:-1,texture:"montane",isVisible:(s,t,r,n,o)=>{var e,l,c,f,u,a;return((c=(l=(e=s[t])==null?void 0:e[r])==null?void 0:l[n])==null?void 0:c.isBlock)&&!((a=(u=(f=s[t])==null?void 0:f[r])==null?void 0:u[o])!=null&&a.isBlock)},applyStyle:(s,t,r,n)=>{var o,e,l;return n>=0&&((l=(e=(o=s[t])==null?void 0:o[r])==null?void 0:e[n])==null?void 0:l.shadedTop)===!0},map:(s,t,r,n)=>[t*r,s*r]},{name:"bottom",offset:0,texture:"desert",isVisible:(s,t,r,n,o)=>{var e,l,c,f,u,a;return((c=(l=(e=s[t])==null?void 0:e[r])==null?void 0:l[o])==null?void 0:c.isBlock)&&!((a=(u=(f=s[t])==null?void 0:f[r])==null?void 0:u[n])!=null&&a.isBlock)},map:(s,t,r,n)=>[t*r,s*r]}],x:[{name:"right",offset:-1,texture:"steppe",isVisible:(s,t,r,n,o)=>{var e,l,c,f,u,a;return((c=(l=(e=s[t])==null?void 0:e[n])==null?void 0:l[o])==null?void 0:c.isBlock)&&!((a=(u=(f=s[r])==null?void 0:f[n])==null?void 0:u[o])!=null&&a.isBlock)},map:(s,t,r,n)=>[s*r,(n-t-1)*r]},{name:"left",offset:0,texture:"steppe",isVisible:(s,t,r,n,o)=>{var e,l,c,f,u,a;return((c=(l=(e=s[r])==null?void 0:e[n])==null?void 0:l[o])==null?void 0:c.isBlock)&&!((a=(u=(f=s[t])==null?void 0:f[n])==null?void 0:u[o])!=null&&a.isBlock)},map:(s,t,r,n)=>[s*r,(n-t-1)*r]}],y:[{name:"front",offset:-1,texture:"steppe",isVisible:(s,t,r,n,o)=>{var e,l,c,f,u,a;return((c=(l=(e=s[t])==null?void 0:e[r])==null?void 0:l[o])==null?void 0:c.isBlock)&&!((a=(u=(f=s[t])==null?void 0:f[n])==null?void 0:u[o])!=null&&a.isBlock)},map:(s,t,r,n)=>[t*r,(n-s-1)*r]},{name:"back",offset:0,texture:"steppe",isVisible:(s,t,r,n,o)=>{var e,l,c,f,u,a;return((c=(l=(e=s[t])==null?void 0:e[n])==null?void 0:l[o])==null?void 0:c.isBlock)&&!((a=(u=(f=s[t])==null?void 0:f[r])==null?void 0:u[o])!=null&&a.isBlock)},map:(s,t,r,n)=>[t*r,(n-s-1)*r]}]};function G(s,t){const r=m.length,n=m[0].length;m[0][0].length;const o=20*10,e=10,l=Math.floor(e/2),c=Math.floor(s.length/2);s.forEach((f,u)=>{const a=f.getContext("2d");a.clearRect(0,0,f.width,f.height);const d=t==="z"?i.worldZ-c+u:t==="x"?i.worldX-c+u:i.worldY-c+u;for(let h=0;h<e;h++)for(let p=0;p<e;p++)if(t==="z"?(v=i.worldX-l+p,z=i.worldY-l+h):t==="x"?(v=d,z=i.worldY-l+h,L=i.worldZ-l+p):(v=i.worldX-l+p,z=d,L=i.worldZ-l+h),!(v<0||z<0||L<-20||v>=r||z>=n||L>=19))for(const x of ie[t]){const[M,y]=x.map(h,p,o,e);let w=!1,k=!1;if(t==="z"){const X=d-1,Y=d;w=x.isVisible(m,v,z,X,Y),k=typeof x.applyStyle=="function"?x.applyStyle(m,v,z,X):!1}else if(t==="x"){const X=d-1,Y=d;w=x.isVisible(m,X,Y,z,L)}else if(t==="y"){const X=d-1,Y=d;w=x.isVisible(m,v,X,Y,L)}w&&(a.save(),k&&(a.filter="brightness(80%)"),a.drawImage(V[x.texture],0,0,100,100,M,y,o,o),a.restore())}})}function ce(s,t){const r=m.length,n=m[0].length,o=m[0][0].length;if(s<0||s>=r||t<0||t>=n)return 0;for(let e=o-2;e>=0;e--)if(m[s][t][e].material!="air")return e;return 6}async function de(s){let t=!1;const r=-g.yaw*Math.PI/180,n=Math.round(Math.cos(r)),o=Math.round(Math.sin(r)),e=Math.round(Math.cos(r+Math.PI/2)),l=Math.round(Math.sin(r+Math.PI/2));switch(s.key.toLowerCase()){case"a":i.worldX+n>=7&&i.worldX+n<m.length-7&&i.worldY+o>=7&&i.worldY+o<m[0].length-7&&(i.worldX+=n,i.worldY+=o,t=!0);break;case"d":i.worldX-n>=7&&i.worldX-n<m.length-7&&i.worldY-o>=7&&i.worldY-o<m[0].length-7&&(i.worldX-=n,i.worldY-=o,t=!0);break;case"w":i.worldX+e>=7&&i.worldX+e<m.length-7&&i.worldY+l>=7&&i.worldY+l<m[0].length-7&&(i.worldX+=e,i.worldY+=l,t=!0);break;case"s":i.worldX-e>=7&&i.worldX-e<m.length-7&&i.worldY-l>=7&&i.worldY-l<m[0].length-7&&(i.worldX-=e,i.worldY-=l,t=!0);break}if(t){fe(),await re(),Q(),_(),ue(),K();const c=document.querySelector(".floor");i.worldZ<=6?c.classList.add("visible"):c.classList.remove("visible")}}function fe(){const s=ce(i.worldX,i.worldY);i.worldZ=s+2}const N=document.getElementById("xyz");function ue(){N.querySelector("#x").textContent=i.worldX,N.querySelector("#y").textContent=i.worldY,N.querySelector("#z").textContent=i.worldZ}window.addEventListener("keydown",de);let g={pointerLock:!1,yaw:0,pitch:90,zoom:40};async function me(){oe(),ne(),le()}document.addEventListener("DOMContentLoaded",async()=>{await me()});const pe=document.getElementById("renderer"),T=document.getElementById("engine-wrapper");document.addEventListener("mousemove",ge);document.addEventListener("keydown",s=>{s.code==="Space"&&(s.preventDefault(),he())});function he(){const s=T.requestPointerLock||T.mozRequestPointerLock||T.webkitRequestPointerLock;document.pointerLockElement===T?(g.pointerLock=!1,document.exitPointerLock()):(g.pointerLock=!0,s.call(T))}function ge(s){if(g.pointerLock===!1)return;const t=s.movementX||s.mozMovementX||s.webkitMovementX||0,r=s.movementY||s.mozMovementY||s.webkitMovementY||0;g.yaw+=-(t/window.innerWidth)*180,g.pitch+=r/window.innerHeight*60,g.yaw>360&&(g.yaw=0),g.yaw<0&&(g.yaw=360),K(),Q()}function K(){pe.style.transform=`
  
    rotateX(${-g.pitch}deg)  /* Pitch - applied first */
    rotateY(${-g.yaw}deg) /* Yaw - applied second */
    scale3d(${g.zoom}, ${g.zoom}, ${g.zoom}) 
 translateY(-50px) translateX(50px) translateZ(50px)
    `}function Q(){H.forEach((s,t)=>{t.style.setProperty("--rotation-z",`${g.yaw}deg`)})}
